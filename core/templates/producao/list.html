{% extends "base.html" %}
{% block title %}Produção — NefroPy{% endblock %}

{% block content %}
<h2 class="h5 fw-bold mb-3">
  <i class="bi bi-clipboard2-check me-2"></i>Produção
</h2>

{# ---------- MOBILE: CARDS (uma linha por Data + Hospital) ---------- #}
<div class="d-md-none vstack gap-2">
  {% for r in agregados %}
    <div class="card shadow-sm">
      <div class="card-body">
        <details class="mb-0">
          <summary class="d-flex justify-content-between align-items-start list-unstyled" style="cursor:pointer;">
            <div>
              <div class="fw-semibold">{{ r.paciente__hospital__nome|default:"—" }}</div>
              <div class="small text-secondary">{{ r.data|date:"d/m/Y" }}</div>
            </div>
            <div class="text-end">
              <div class="fw-bold">R$ {{ r.total|floatformat:2 }}</div>
              <div class="small text-primary">ver detalhes ▾</div>
            </div>
          </summary>

          <div
            id="m-{{ r.data|date:'Ymd' }}-{{ r.paciente__hospital_id }}"
            class="mt-2"
            hx-get="{% url 'producao_detalhe' r.data|date:'Y-m-d' r.paciente__hospital_id %}"
            hx-trigger="toggle from:closest details once"
            hx-target="this"
            hx-swap="innerHTML"
          ></div>
        </details>
      </div>
    </div>
  {% empty %}
    <div class="text-center text-secondary py-4">Sem lançamentos.</div>
  {% endfor %}

  <!-- total geral (card) -->
  <div class="card shadow-sm">
    <div class="card-body d-flex justify-content-between">
      <div class="fw-semibold">Total geral</div>
      <div class="text-end fw-bold">R$ {{ total_geral|floatformat:2 }}</div>
    </div>
  </div>
</div>

{# ---------- DESKTOP: CARDS (mesmo comportamento do mobile) ---------- #}
<div class="d-none d-md-block vstack gap-2">
  {% for r in agregados %}
    <div class="card shadow-sm">
      <div class="card-body">
        <details class="mb-0">
          <summary class="d-flex justify-content-between align-items-start list-unstyled" style="cursor:pointer;">
            <div>
              <div class="fw-semibold">{{ r.paciente__hospital__nome|default:"—" }}</div>
              <div class="small text-secondary">{{ r.data|date:"d/m/Y" }}</div>
            </div>
            <div class="text-end">
              <div class="fw-bold">R$ {{ r.total|floatformat:2 }}</div>
              <div class="small text-primary">ver detalhes ▾</div>
            </div>
          </summary>

          <div
            id="d-{{ r.data|date:'Ymd' }}-{{ r.paciente__hospital_id }}"
            class="mt-2"
            hx-get="{% url 'producao_detalhe' r.data|date:'Y-m-d' r.paciente__hospital_id %}"
            hx-trigger="toggle from:closest details once"
            hx-target="this"
            hx-swap="innerHTML"
          ></div>

        </details>
      </div>
    </div>
  {% empty %}
    <div class="text-center text-secondary py-4">Sem lançamentos.</div>
  {% endfor %}

  <!-- total geral (card) -->
  <div class="card shadow-sm">
    <div class="card-body d-flex justify-content-between">
      <div class="fw-semibold">Total geral</div>
      <div class="text-end fw-bold">R$ {{ total_geral|floatformat:2 }}</div>
    </div>
  </div>
</div>
{% endblock %}
